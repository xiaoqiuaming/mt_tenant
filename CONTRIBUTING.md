# YaoBase 多租户资源隔离贡献指南

## 概述

本项目致力于实现YaoBase数据库的多租户资源隔离功能。贡献者需遵循以下指南，确保代码质量、模块设计优雅可靠、可测试。

## C++代码规范

### 命名规范
- **类名**：PascalCase，如 `TenantManager`
- **函数名**：camelCase，如 `allocateMemory`
- **变量名**：camelCase，如 `tenantId`
- **常量**：UPPER_SNAKE_CASE，如 `MAX_TENANT_COUNT`
- **私有成员**：以 `m_` 前缀，如 `m_tenantId`

### 代码风格
- 使用4个空格缩进
- 行长度不超过120字符
- 函数长度不超过50行
- 类长度不超过500行

### 错误处理
- 使用异常处理关键错误
- 返回值表示操作结果
- 提供详细的错误信息

### 注释规范
- 每个类和函数要有文档注释
- 使用Doxygen格式
- 复杂逻辑要有行内注释

## 容器使用指南

### 智能指针
- 优先使用 `std::unique_ptr` 管理独占资源
- 使用 `std::shared_ptr` 管理共享资源
- 避免裸指针，除非必要

### STL容器选择
- **vector**：连续存储，随机访问快
- **list**：双向链表，插入删除快
- **map/set**：有序容器，查找快
- **unordered_map/unordered_set**：哈希容器，平均查找快

### 容器使用原则
- 选择合适的容器类型
- 预留容量避免频繁重分配
- 使用范围for循环遍历
- 注意迭代器失效问题

## 模块设计原则

### 设计原则
- **单一职责**：每个模块只负责一个功能
- **开闭原则**：对扩展开放，对修改关闭
- **依赖倒置**：依赖抽象，不依赖具体实现
- **接口隔离**：接口细化，避免臃肿

### 模块结构
```
src/
├── core/           # 核心组件
│   ├── tenant/     # 租户管理
│   ├── resource/   # 资源管理
│   └── monitor/    # 监控组件
├── server/         # 服务器组件
│   ├── sql/        # SQL服务器
│   ├── trans/      # 事务服务器
│   └── data/       # 数据服务器
└── common/         # 公共组件
    ├── utils/      # 工具类
    └── config/     # 配置管理
```

### 可测试性设计
- **依赖注入**：通过构造函数注入依赖
- **接口抽象**：使用抽象类或接口
- **Mock对象**：为外部依赖创建Mock
- **单元测试**：每个类要有对应的测试

## 开发流程

### 1. 代码提交
- 提交前运行所有测试
- 代码通过静态检查
- 提交信息清晰描述变更

### 2. 代码审查
- 至少一人审查
- 关注代码规范和设计原则
- 确保测试覆盖率

### 3. 持续集成
- 自动化构建和测试
- 代码质量检查
- 性能回归测试

## 性能优化

### 内存管理
- 避免内存泄漏
- 合理使用对象池
- 注意大对象的拷贝

### 并发处理
- 使用适当的同步机制
- 避免死锁
- 考虑锁的粒度

### 资源隔离实现
- CPU隔离：线程池管理
- 内存隔离：配额检查
- 磁盘隔离：使用统计

## 文档要求

### 代码文档
- 每个公共接口要有文档
- 复杂算法要有说明
- 配置参数要有解释

### 设计文档
- 架构设计说明
- 接口设计规范
- 部署和配置指南

## 质量保证

### 测试策略
- **单元测试**：覆盖核心逻辑
- **集成测试**：验证模块间交互
- **性能测试**：确保性能指标
- **压力测试**：验证高负载情况

### 代码质量
- 静态代码分析
- 代码覆盖率 > 80%
- 圈复杂度控制在合理范围内

## 贡献流程

1. Fork项目
2. 创建特性分支
3. 提交变更
4. 发起Pull Request
5. 代码审查通过后合并

## 联系方式

如有问题，请联系项目维护者或在Issue中讨论。